<div class="d-flex flex-column gap-3">
  <section class="card border-0 shadow-sm">
    <div class="card-body p-4 p-md-5">
      <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
        <h1 class="h3 mb-0" id="index-welcome-title">Добре дошъл в TrainCrewHub</h1>
      </div>
      <p class="text-secondary mb-0" id="index-welcome-subtitle">Зареждане на профил...</p>
    </div>
  </section>

  <section class="card border-0 shadow-sm">
    <div class="card-body p-4">
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
        <h2 class="h5 mb-0">Бързи действия</h2>
        <span class="text-secondary small">Навигация към основните екрани</span>
      </div>
      <div class="d-flex flex-wrap gap-2" id="index-quick-actions">
        <a href="/planned-duties" data-link class="btn btn-outline-primary">Планирани повески</a>
        <a href="/actual-duties" data-link class="btn btn-outline-primary">Реални повески</a>
        <a href="/employees" data-link class="btn btn-outline-primary">Служители</a>
        <a href="/plan-schedule" data-link class="btn btn-outline-primary">План-График</a>
        <a href="/schedule" data-link class="btn btn-outline-primary">График</a>
      </div>
    </div>
  </section>

  <section class="card border-0 shadow-sm" id="index-management-section">
    <div class="card-body p-4">
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
        <h2 class="h5 mb-0" id="index-management-title">Оперативен преглед за днес</h2>
        <button type="button" class="btn btn-sm btn-outline-secondary" id="index-refresh">Опресни</button>
      </div>
      <div class="row g-3" id="index-kpis">
        <div class="col-6 col-xl-3" id="index-kpi-card-planned">
          <article class="border rounded p-3 h-100">
            <div class="text-secondary small mb-1" id="index-kpi-label-1">Планирани повески</div>
            <div class="h4 mb-0" id="index-kpi-planned">-</div>
          </article>
        </div>
        <div class="col-6 col-xl-3" id="index-kpi-card-actual">
          <article class="border rounded p-3 h-100">
            <div class="text-secondary small mb-1" id="index-kpi-label-2">Реални повески</div>
            <div class="h4 mb-0" id="index-kpi-actual">-</div>
          </article>
        </div>
        <div class="col-6 col-xl-3" id="index-kpi-card-absences">
          <article class="border rounded p-3 h-100">
            <div class="text-secondary small mb-1" id="index-kpi-label-3">Активни отсъствия</div>
            <div class="h4 mb-0" id="index-kpi-absences">-</div>
          </article>
        </div>
        <div class="col-6 col-xl-3" id="index-kpi-card-employees">
          <article class="border rounded p-3 h-100">
            <div class="text-secondary small mb-1" id="index-kpi-label-4">Активни служители</div>
            <div class="h4 mb-0" id="index-kpi-employees">-</div>
          </article>
        </div>
      </div>

      <section class="border rounded p-3 mt-3 d-none" id="index-certificates-panel">
        <h3 class="h6 mb-3">Сертификати</h3>
        <div class="d-flex flex-column gap-2">
          <div class="d-flex justify-content-between align-items-center border rounded p-2">
            <span>Изтичат до 30 дни</span>
            <button
              type="button"
              class="badge text-bg-warning border-0"
              id="index-certificates-soon-toggle"
              data-index-cert-action="toggle-soon"
            >
              0
            </button>
          </div>
          <div class="table-responsive tch-no-scroll-mobile d-none" id="index-certificates-soon-details">
            <table class="table table-sm align-middle mb-0">
              <thead>
                <tr>
                  <th>Служител</th>
                  <th>Сертификат</th>
                  <th>Дата</th>
                </tr>
              </thead>
              <tbody id="index-certificates-soon-body">
                <tr><td colspan="3" class="text-secondary">Няма служители.</td></tr>
              </tbody>
            </table>
          </div>

          <div class="d-flex justify-content-between align-items-center border rounded p-2">
            <span>Вече изтекли</span>
            <button
              type="button"
              class="badge text-bg-danger border-0"
              id="index-certificates-expired-toggle"
              data-index-cert-action="toggle-expired"
            >
              0
            </button>
          </div>
          <div class="table-responsive tch-no-scroll-mobile d-none" id="index-certificates-expired-details">
            <table class="table table-sm align-middle mb-0">
              <thead>
                <tr>
                  <th>Служител</th>
                  <th>Сертификат</th>
                  <th>Дата</th>
                </tr>
              </thead>
              <tbody id="index-certificates-expired-body">
                <tr><td colspan="3" class="text-secondary">Няма служители.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="border rounded p-3 mt-3 d-none" id="index-absences-panel">
        <h3 class="h6 mb-3">Отсъстващи</h3>
        <div class="d-flex flex-column gap-2" id="index-absence-reasons-body">
          <p class="text-secondary mb-0">Няма активни отсъствия.</p>
        </div>
      </section>

      <section class="border rounded p-3 mt-3 d-none" id="index-workload-panel">
        <div class="d-flex flex-wrap align-items-end justify-content-between gap-2 mb-3">
          <h3 class="h6 mb-0">Натовареност на всички служители</h3>
          <div class="d-flex align-items-end gap-2">
            <div>
              <label for="index-workload-date" class="form-label mb-1">Към дата</label>
              <input id="index-workload-date" type="date" class="form-control form-control-sm" />
            </div>
            <button id="index-workload-refresh" type="button" class="btn btn-sm btn-outline-secondary">Опресни</button>
          </div>
        </div>

        <div class="table-responsive tch-no-scroll-mobile">
          <table class="table table-sm align-middle mb-0">
            <thead>
              <tr>
                <th>Служител</th>
                <th>Планирани</th>
                <th>Реални</th>
                <th>Норма</th>
                <th>Отклонение</th>
              </tr>
            </thead>
            <tbody id="index-workload-body">
              <tr>
                <td colspan="5" class="text-secondary">Няма данни.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="border rounded p-3 mt-3 d-none" id="index-pending-users-panel">
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
          <h3 class="h6 mb-0">Чакащи потребители за роля</h3>
          <div class="d-flex align-items-center gap-2">
            <span class="badge text-bg-warning" id="index-pending-users-count">0</span>
            <a href="/admin" data-link class="btn btn-sm btn-outline-primary">Към роли</a>
          </div>
        </div>
        <div id="index-pending-users-body" class="list-group list-group-flush rounded border">
          <div class="list-group-item text-secondary small">Няма чакащи потребители.</div>
        </div>
      </section>

      <p class="text-secondary small mt-3 mb-0" id="index-last-updated">-</p>
    </div>
  </section>

  <section class="card border-0 shadow-sm d-none" id="index-crew-section">
    <div class="card-body p-4">
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
        <h2 class="h5 mb-0">Моите повески за месеца</h2>
        <div class="d-flex align-items-center gap-2">
          <button type="button" class="btn btn-sm btn-outline-secondary" id="index-crew-prev-month">◀</button>
          <div class="fw-semibold" id="index-crew-month-label">-</div>
          <button type="button" class="btn btn-sm btn-outline-secondary" id="index-crew-next-month">▶</button>
          <button type="button" class="btn btn-sm btn-outline-primary" id="index-crew-today-month">Днес</button>
          <button type="button" class="btn btn-sm btn-outline-secondary" id="index-refresh-crew">Опресни</button>
        </div>
      </div>

      <div class="index-crew-calendar-weekdays mb-2" aria-hidden="true">
        <span>Пн</span>
        <span>Вт</span>
        <span>Ср</span>
        <span>Чт</span>
        <span>Пт</span>
        <span>Сб</span>
        <span>Нд</span>
      </div>

      <div class="index-crew-calendar-days mb-3" id="index-crew-calendar-days"></div>

      <div class="d-flex flex-wrap align-items-center gap-2 mb-3 small text-secondary">
        <span class="badge text-bg-primary">П</span>
        <span>Планирани</span>
        <span class="badge text-bg-success">Р</span>
        <span>Реални</span>
        <span class="badge text-bg-warning">Промяна</span>
        <span>Смяна на служител — чака потвърждение</span>
        <span class="badge text-bg-info">ΔN</span>
        <span>Брой промени</span>
      </div>

      <section class="border rounded p-3 mb-3" id="index-crew-hours-summary">
        <div class="row g-3">
          <div class="col-12 col-md-3">
            <div class="text-secondary small">Планирани часове до дата</div>
            <div class="fw-semibold" id="index-crew-planned-hours-total">00:00</div>
          </div>
          <div class="col-12 col-md-3">
            <div class="text-secondary small">Реални часове до дата</div>
            <div class="fw-semibold" id="index-crew-actual-hours-total">00:00</div>
          </div>
          <div class="col-12 col-md-3">
            <div class="text-secondary small">Норма (работни дни BG) до дата</div>
            <div class="fw-semibold" id="index-crew-norm-hours-total">00:00</div>
          </div>
          <div class="col-12 col-md-3">
            <div class="text-secondary small">Отклонение (Реални − Норма)</div>
            <div class="fw-semibold" id="index-crew-deviation-hours-total">+00:00</div>
          </div>
        </div>
      </section>

      <h3 class="h6 mb-2" id="index-crew-selected-date-label">Избери ден</h3>

      <div class="row g-3">
        <div class="col-12 col-xl-6">
          <h3 class="h6">Планирани</h3>
          <div class="d-flex flex-column gap-2" id="index-crew-planned-body">
            <p class="text-secondary mb-0">Няма планирани повески.</p>
          </div>
        </div>
        <div class="col-12 col-xl-6">
          <h3 class="h6">Реални</h3>
          <div class="d-flex flex-column gap-2" id="index-crew-actual-body">
            <p class="text-secondary mb-0">Няма реални повески.</p>
          </div>
        </div>
      </div>

      <div class="mt-3">
        <h3 class="h6">Промени за деня</h3>
        <div class="d-flex flex-column gap-2" id="index-crew-change-body">
          <p class="text-secondary mb-0">Няма регистрирани промени за избрания ден.</p>
        </div>
      </div>

      <div class="mt-3">
        <h3 class="h6">Отсъствия</h3>
        <div class="d-flex flex-column gap-2" id="index-crew-absence-body">
          <p class="text-secondary mb-0">Няма отсъствия за избрания ден.</p>
        </div>
      </div>

      <p class="text-secondary small mt-3 mb-0" id="index-crew-last-updated">-</p>
    </div>
  </section>
</div>

<div id="index-timetable-preview-modal" class="d-none position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-50" style="z-index: 1070;">
  <div class="d-flex align-items-center justify-content-center h-100 p-3 p-md-4">
    <div class="card w-100" style="max-width: 1100px;">
      <div class="card-body p-3 p-md-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 id="index-timetable-preview-title" class="h5 mb-0">Преглед на разписание</h2>
          <div class="d-flex align-items-center gap-2">
            <a id="index-timetable-preview-open" href="#" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline-primary">Отвори файла</a>
            <button id="index-timetable-preview-close" type="button" class="btn-close" aria-label="Close"></button>
          </div>
        </div>
        <div id="index-timetable-preview-fallback" class="alert alert-info py-2 d-none" role="alert">
          Този тип файл може да не се визуализира вградено. Използвай „Отвори файла" за директен преглед.
        </div>
        <iframe
          id="index-timetable-preview-frame"
          title="Преглед на разписание"
          class="w-100 border rounded"
          style="height: min(72vh, 760px);"
        ></iframe>
      </div>
    </div>
  </div>
</div>

<div id="index-actual-duty-edit-modal" class="d-none position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-50" style="z-index: 1070;">
  <div class="d-flex align-items-center justify-content-center h-100 p-3 p-md-4">
    <div class="card w-100" style="max-width: 620px;">
      <div class="card-body p-3 p-md-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="h5 mb-0">Редакция на реална повеска</h2>
          <button id="index-actual-duty-edit-close" type="button" class="btn-close" aria-label="Close"></button>
        </div>

        <form id="index-actual-duty-edit-form" class="row g-3">
          <input type="hidden" id="index-actual-duty-edit-id" />

          <div class="col-6">
            <label for="index-actual-duty-start" class="form-label">Начало</label>
            <input id="index-actual-duty-start" type="time" class="form-control" required />
          </div>

          <div class="col-6">
            <label for="index-actual-duty-end" class="form-label">Край</label>
            <input id="index-actual-duty-end" type="time" class="form-control" required />
          </div>

          <div class="col-6">
            <label for="index-actual-duty-break-start" class="form-label">Начало на прекъсване</label>
            <input id="index-actual-duty-break-start" type="time" class="form-control" required />
          </div>

          <div class="col-6">
            <label for="index-actual-duty-break-end" class="form-label">Край на прекъсване</label>
            <input id="index-actual-duty-break-end" type="time" class="form-control" required />
          </div>

          <div class="col-12 d-flex justify-content-end gap-2 mt-2">
            <button id="index-actual-duty-edit-cancel" type="button" class="btn btn-outline-secondary">Отказ</button>
            <button id="index-actual-duty-edit-save" type="submit" class="btn btn-primary">Запази</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
